unit uPostgresVersion;

interface

uses
  uInstanceController,

  FireDAC.Stan.Error,FireDAC.DatS,FireDAC.Comp.UI,
  System.SysUtils, System.Classes, Data.DB,
  FireDAC.Comp.Client, FireDAC.Stan.Def, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Pool, FireDAC.Stan.Async,
  FireDAC.Phys.SQLite, FireDAC.Phys.SQLiteDef,
  FireDAC.DApt, FireDAC.UI.Intf, FireDAC.VCLUI.Wait,
  System.Generics.Collections;

type
  TPostgresVersion = class  // Representa uma tabela no SQLite3
    private
      FVersion: Integer;
      FId: Integer;
      FPathBinPG: String;
      FPostgresName: String;
      FPort: Integer;
      FPass: String;
      FUser: String;
    public
      property Id: Integer          read FId           write FId;
      property PostgresName: String read FPostgresName write FPostgresName;
      property Version: Integer     read FVersion      write FVersion;
      property PathBinPG: String    read FPathBinPG    write FPathBinPG;
      property User: String         read FUser         write FUser;
      property Pass: String         read FPass         write FPass;
      property Port: Integer        read FPort         write FPort;



      class function GetAllVersions : TObjectList<TPostgresVersion>;
  end;

implementation

{ TPostgresVersion }

class function TPostgresVersion.GetAllVersions: TObjectList<TPostgresVersion>;
var
  vQuery : TFDQuery;
  vPGVersion : TPostgresVersion;
begin

  Result := TObjectList<TPostgresVersion>.Create;

  vQuery := TInstanceController.GetInstance().SQLiteConnection.GetQuery;
  try
    with vQuery do
    begin
      SQL.Text := 'SELECT version FROM tb_postgres_versions';
      Open;

      while not Eof do
      begin
        vPGVersion          := TPostgresVersion.Create;
        vPGVersion.FVersion := FieldByName('version').AsInteger;

        Result.Add(vPGVersion);
      Next;
      end;
    end;
  except
    raise Exception.Create('Erro ao pegar as versões no banco.');
  end;
end;


end.
